<div class="min-h-screen bg-gray-900 p-6">
  <div class="max-w-2xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-blue-400 mb-2">
        {{ esEdicion() ? 'Editar Evaluación' : 'Nueva Evaluación' }}
      </h1>
      <p class="text-gray-400">
        {{
          esEdicion()
            ? 'Modifica la información de la evaluación'
            : 'Registra una nueva evaluación para un curso'
        }}
      </p>
    </div>

    <!-- Error -->
    @if (errorMessage()) {
    <div class="mb-6 p-4 bg-red-900/30 border border-red-700 rounded-lg">
      <p class="text-red-400">{{ errorMessage() }}</p>
    </div>
    }

    <!-- Formulario -->
    <form [formGroup]="evaluacionForm" (ngSubmit)="onSubmit()" class="space-y-6">
      <!-- ID del Curso -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">
          ID del Curso <span class="text-red-400">*</span>
        </label>
        <input
          type="number"
          formControlName="cursoId"
          min="1"
          class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-400/50"
          placeholder="Ingresa el ID del curso"
        />
        @if (cursoIdControl.invalid && cursoIdControl.touched) {
        <div class="mt-1 space-y-1">
          @if (cursoIdControl.hasError('required')) {
          <p class="text-red-400 text-sm">El ID del curso es obligatorio</p>
          } @if (cursoIdControl.hasError('min')) {
          <p class="text-red-400 text-sm">El ID debe ser mayor a 0</p>
          }
        </div>
        }
      </div>

      <!-- Título -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">
          Título <span class="text-red-400">*</span>
        </label>
        <input
          type="text"
          formControlName="titulo"
          class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-400/50"
          placeholder="Ej: Parcial 1, Trabajo Final, Examen Final"
        />
        @if (tituloControl.invalid && tituloControl.touched) {
        <div class="mt-1 space-y-1">
          @if (tituloControl.hasError('required')) {
          <p class="text-red-400 text-sm">El título es obligatorio</p>
          } @if (tituloControl.hasError('minlength')) {
          <p class="text-red-400 text-sm">Mínimo 3 caracteres</p>
          } @if (tituloControl.hasError('maxlength')) {
          <p class="text-red-400 text-sm">Máximo 100 caracteres</p>
          }
        </div>
        }
      </div>

      <!-- Tipo -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">
          Tipo <span class="text-red-400">*</span>
        </label>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-2">
          @for (tipo of evaluacionService.tipos; track tipo) {
          <label
            class="flex items-center p-3 bg-gray-800/50 border border-gray-700 rounded-lg hover:bg-gray-800 cursor-pointer"
          >
            <input
              type="radio"
              formControlName="tipo"
              [value]="tipo"
              class="w-4 h-4 text-blue-400 bg-gray-800 border-gray-600 focus:ring-blue-400"
            />
            <span class="ml-3 text-gray-300 text-sm">{{ tipo }}</span>
          </label>
          }
        </div>
        @if (tipoControl.invalid && tipoControl.touched) {
        <p class="text-red-400 text-sm mt-1">Selecciona un tipo de evaluación</p>
        }
      </div>

      <!-- Fecha y Ponderación -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Fecha -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">
            Fecha <span class="text-red-400">*</span>
          </label>
          <input
            type="date"
            formControlName="fecha"
            [min]="getFechaMinima()"
            class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-400/50"
          />
          @if (fechaControl.invalid && fechaControl.touched) {
          <p class="text-red-400 text-sm mt-1">Selecciona una fecha válida</p>
          }
        </div>

        <!-- Ponderación -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">
            Ponderación (%) <span class="text-red-400">*</span>
          </label>
          <div class="relative">
            <input
              type="number"
              formControlName="ponderacion"
              min="0"
              max="100"
              step="0.01"
              class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-400/50 pr-10"
              placeholder="0-100"
            />
            <span class="absolute right-3 top-3 text-gray-500">%</span>
          </div>
          @if (ponderacionControl.invalid && ponderacionControl.touched) {
          <div class="mt-1 space-y-1">
            @if (ponderacionControl.hasError('required')) {
            <p class="text-red-400 text-sm">La ponderación es obligatoria</p>
            } @if (ponderacionControl.hasError('min') || ponderacionControl.hasError('max')) {
            <p class="text-red-400 text-sm">Debe ser un valor entre 0 y 100</p>
            }
          </div>
          }
        </div>
      </div>

      <!-- Estado activo -->
      <div class="flex items-center p-4 bg-gray-800/50 border border-gray-700 rounded-lg">
        <input
          type="checkbox"
          formControlName="activo"
          id="activo"
          class="w-5 h-5 text-blue-400 bg-gray-800 border-gray-600 rounded focus:ring-blue-400"
        />
        <label for="activo" class="ml-3 text-gray-300 cursor-pointer">
          <span class="block font-medium">Evaluación activa</span>
          <span class="text-sm text-gray-400"
            >La evaluación estará disponible para los estudiantes</span
          >
        </label>
      </div>

      <!-- Loading -->
      @if (isLoading()) {
      <div class="flex items-center justify-center p-4">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400"></div>
        <span class="ml-3 text-blue-400">
          {{ esEdicion() ? 'Actualizando evaluación...' : 'Creando evaluación...' }}
        </span>
      </div>
      }

      <!-- Botones -->
      <div class="flex justify-end space-x-4 pt-6 border-t border-gray-700">
        <button
          type="button"
          (click)="cancelar()"
          class="px-6 py-3 border border-gray-600 text-gray-300 rounded-lg hover:bg-gray-700/50 transition-colors"
          [disabled]="isLoading()"
        >
          Cancelar
        </button>
        <button
          type="submit"
          [disabled]="evaluacionForm.invalid || isLoading()"
          class="px-6 py-3 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          [class]="
            evaluacionForm.invalid || isLoading()
              ? 'bg-gray-600 text-gray-400'
              : 'bg-blue-500 hover:bg-blue-400 text-white'
          "
        >
          {{ esEdicion() ? 'Actualizar Evaluación' : 'Crear Evaluación' }}
        </button>
      </div>
    </form>
  </div>
</div>
